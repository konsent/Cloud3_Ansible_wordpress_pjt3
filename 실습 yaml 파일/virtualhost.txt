- hosts: AA
  tasks:
  - apt:
      name: apache2
      state: latest
      update_cache: yes

  - service:
      name: apache2
      state: started
      enabled: yes

  - file:
      path: /var/www/html0
      state: directory

  - template:
      src: webpage.j2
      dest: /var/www/html0/index.html

  - template:
      src: host.j2
      dest: "/etc/apache2/sites-available/00_{{ ansible_hostname }}.com.conf"

  - lineinfile:
      path: /etc/apache2/ports.conf
      insertafter: "Listen 80"
      line: Listen 8080

  - command: "a2ensite 00_{{ ansible_hostname }}.com.conf"

  - service:
      name: apache2
      state: restarted