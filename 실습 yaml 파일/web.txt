- hosts: ansi-node3
  tasks:
  - apt:
      name: apache2
      state: latest
      update_cache: yes

  - ufw:
      rule: allow
      port: '80'
      proto: tcp

  - apt:
      name: aptitude
      update_cache: yes
      state: latest
      force_apt_get: yes

  - name: software-properties-common
    apt:
      name: software-properties-common
      state: latest

  - apt_repository:
      repo: ppa:ondrej/php

  - apt:
      update_cache: yes

  - name: install php 7.4
    apt:
      name: php7.4
      state: present

  - name: install lamp stack
    apt:
      pkg:
        - php7.4-mysql
        - php7.4-common
        - php7.4-xml
        - php7.4-xmlrpc
        - php7.4-curl
        - php7.4-gd
        - php7.4-imagick
        - php7.4-cli
        - php7.4-dev
        - php7.4-imap
        - php7.4-mbstring
        - php7.4-opcache
        - php7.4-soap
        - php7.4-zip
        - php7.4-intl
        - libapache2-mod-php
      state: present
      update_cache: yes

  - service:
      name: apache2
      state: restarted

  - get_url:
      url: https://wordpress.org/latest.tar.gz
      dest: /tmp/wordpress.tar.gz

  - unarchive:
      src: /tmp/wordpress.tar.gz
      remote_src: true
      dest: /var/www/html

  - copy:
      src: /var/www/html/wordpress/wp-config-sample.php
      dest: /var/www/html/wordpress/wp-config.php
      remote_src: yes

  - replace:
      path: /var/www/html/wordpress/wp-config.php
      regexp: database_name_here
      replace: wordpress

  - replace:
      path: /var/www/html/wordpress/wp-config.php
      regexp: username_here
      replace: admin

  - replace:
      path: /var/www/html/wordpress/wp-config.php
      regexp: password_here
      replace: dkaghdkagh1.

  - replace:
      path: /var/www/html/wordpress/wp-config.php
      regexp: localhost
      replace: 192.168.56.22
